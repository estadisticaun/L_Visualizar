# Partes principales de un gráfico

```{r message=FALSE, warning=FALSE, include=FALSE}
library(UnalR)
library(UnalData)
library(dplyr)
library(ggplot2)
library(hrbrthemes)
library(readxl)
library(gapminder)
library(stringr)
library(R.utils)
```

A la hora de crear un gráfico es necesario tener presente cada uno de los elementos que lo conforman y determinar cual es la mejor manera de representar cada uno de estos para lograr el impacto deseado en la visualización. El diseño correcto de estos elementos garantizara el éxito de su gráfico, al comunicar de manera acertada la información que pretende presentar. Dentro de la gama de gráficos estadísticos básicos se identifican tres elementos importantes los cuales son ejes, geometría en la cual se incluyen la forma, tamaño y color, tipos de líneas y texto el cual incluye las etiquetas de los ejes, titulo y leyenda.

```{r partesgrafico-fig, echo=FALSE, fig.align='center', fig.asp=.75, fig.cap='Principales partes de un gráfico', out.width='100%'}
knitr::include_graphics("Imágenes/partesdelgrafico.jpg")
```

La figura \@ref(fig:partesgrafico-fig) presenta estos elementos importantes. En los recuadros negros se encierra todo lo relacionado con texto, etiquetas de los ejes, título y leyenda; las líneas naranjadas representan los ejes del gráfico de manera horizontal corre el eje X y de manera vertical el eje Y. En la parte central de la visualización se ubican las observaciones a las cuales se les aplica la geometría, dependiendo del tipo de gráfico es posible cambiar el tamaño, forma y color de cado dato.

A continuación, se presentan las características que se consideraron más importantes para tener en cuenta a la hora de dar formato y personalizar cada uno de los elementos mencionados.

## Ejes

Los ejes son de los elementos de mayor relevancia dentro de cada gráfico ya que determina la posición donde se ubica cada dato. Cuando se trata de gráficos en dos dimensiones, los más comunes, las posiciones son descritas a través de dos valores que especifican un punto de forma única, y por lo tanto se necesitan escalas de posición, estas escalas son generalmente los ejes X y Y. Por convención general el eje X corre horizontalmente y el eje Y lo hace de manera vertical, aunque esto no siempre debe ser así, hay gráficos en los cuales los ejes son radiales.
El objetivo principal de las visualizaciones que se crean es comparar los datos, es decir, identificar el comportamiento de cada observación en relación con las demás que posee el conjunto de datos. Para realizar estas comparaciones es importante definir la escala de los ejes de manera adecuada, una mala elección de estas escalas lo puede conducir a interpretar la información de manera errada; es recomendable iniciar los ejes en 0, aunque no siempre es necesario si es importante considerar que los datos sean comparables.

Para ilustrar la importancia de la correcta elección del inicio del eje Y consideremos la visualización de cantidades a lo largo de una escala lineal. La figura \@ref(fig:usoincorrectoejey-fig) muestra las ventas en cinco estados de EE.UU; una vista rápida a esta visualización indica que las ventas en North Dakota son extremadamente bajas en comparación con los demás estados, sin embargo, este gráfico es engañoso ya que las ventas inician en $\$900$ USD, por lo tanto, mientras que el punto final de cada barra indica de manera correcta el total de ventas, la altura de la barra representa la medida en que las ventas superan los $\$900$ dólares; la percepción humana entenderá la altura de cada barra como las ventas por estado lo que conlleva a una interpretación errónea.


```{r usoincorrectoejey-fig, echo=FALSE, fig.align='center', fig.asp=.75, fig.cap='Ventas por estados de EE.UU, visualiazción engañosa', out.width='80%'}
Sample <- read_excel("Datos/Sample - Superstore.xls")
filtrar <- Sample %>% filter(State %in% c("North Dakota", "West Virginia", 
                                          "Maine", "South Dakota", "Wyoming"))
ggplot(filtrar, aes(x = State, y = Sales)) + 
  geom_bar(stat = "identity", fill = "skyblue") +
  coord_cartesian(ylim = c(900, 1700)) +
  labs(y = "Sales USD", 
       title = "Sales by states in USA")
```

La forma correcta de visualizar estos datos se presenta en la figura \@ref(fig:usocorrectoejeyinicio0-fig), es claro que existen diferencias entre las ventas por estados, pero no son tan distantes como lo muestra la figura \@ref(fig:usoincorrectoejey-fig), las ventas en los cinco estados presentados son comparables. En este caso es particular se debe seguir la regla de iniciar los ejes en cero.   

```{r usocorrectoejeyinicio0-fig, echo=FALSE, fig.align='center', fig.asp=.75, fig.cap='Ventas por estados de EE.UU, uso correcto de la escala lineal', out.width='80%'}
ggplot(filtrar, aes(x = State, y = Sales)) + 
  geom_bar(stat = "identity", fill = "skyblue") +
  coord_cartesian(ylim = c(0, 1700)) +
  labs(y = "Sales USD", 
       title = "Sales by states in USA")
```

## Geometría

La geometría es una parte primordial y que hará las visualizaciones mucho mas claras y entendibles. Dentro de las geometrías principales podemos considerar la forma, tamaño, tipo de línea y color.

### Forma y tipo de línea

Estas dos son estéticas o atributos que generalmente se usan para representar datos categóricos, dentro de visualizaciones discretas o continuas. Cuando se trata de gráficos de dispersión se opta por usar diferentes formas a partir de una variable categórica con el fin de comparar los comportamientos de cada uno de los valores que toma la variable cualitativa. En el caso de los gráficos de líneas se opta por usar diferentes estilos o tipos de líneas nuevamente con el fin de diferenciar la categoría de los datos, por lo general los estilos usados son líneas continuadas y punteadas. Ambos elementos pueden ser usados para distinguir o resaltar, en el caso de ser usados para distinguir se asigna una forma o tipo de línea a cada uno de los niveles de la variable categórica y en el caso de resaltado se usa la misma forma o tipo de línea para todos los datos excepto para aquellos elementos que queremos resaltar.

La figura \@ref(fig:formasparadistinguir-fig) ilustra el uso de distintas formas para distinguir las especies de flores registradas en la base de datos Iris. Como ya se menciono se usan tantas formas como niveles tenga la variable categórica, en este caso se usan círculos, triángulos y cuadrados.

```{r formasparadistinguir-fig, echo=FALSE, fig.align='center', fig.asp=.75, fig.cap='Uso de las formas para distinguir grupos de datos', out.width='80%'}
ggplot(iris, aes(x=Sepal.Length, y=Sepal.Width, shape=Species)) + 
  geom_point(size=2) +
  labs(x = "Sepal Lenght", y = "Sepal Width", 
       title = "Sepal Lenght vs Sepal Width by species")
```

Si quisiéramos resaltar una de las especies por ejemplo, Visicolor debemos asignar la misma forma a las especies Setosa y Virginica y una distinta a la especie a resaltar, por ejemplo usar círculos y triángulos, como se presenta en la figura \@ref(fig:formaspararesaltar-fig).

```{r formaspararesaltar-fig, echo=FALSE, fig.align='center', fig.asp=.75, fig.cap='Uso de las formas para resaltar un grupo de observaciones', out.width='80%'}
ggplot(iris, aes(x=Sepal.Length, y=Sepal.Width)) + 
  geom_point(aes(shape = Species), size = 3) +
  scale_shape_manual(values = c(19, 17, 19)) +
  labs(x = "Sepal Lenght", y = "Sepal Width", 
       title = "Sepal Lenght vs Sepal Width by species")
```

### Tamaño 

El tamaño generalmente es una estética usada en gráficos de dispersión, se incluye una nueva variable continua o discreta que determina el tamaño de cada observación representada en el gráfico. Este atributo es de gran utilidad, pero se debe tener mucho cuidado al usarlo, ya que en el caso de datos desproporcionados un solo punto ocupará un tamaño exagerado que será poco comparable con los demás datos.

La figura \@ref(fig:usotamanodiscreto-fig) ilustra el uso de una variable discreta para asignar diferentes tamaños a las observaciones.

```{r usotamanodiscreto-fig, echo=FALSE, fig.align='center', fig.asp=.75, fig.cap='Asignación de tamaños mediante una variable discreta', message=FALSE, warning=FALSE, out.width='80%'}
ggplot(iris, aes(x=Sepal.Length, y=Sepal.Width, size = Species, color = Species)) + 
  geom_point() + 
  labs(x = "Sepal Lenght", y = "Sepal Width", 
       title = "Sepal Lenght vs Sepal Width by species")
```

La figura \@ref(fig:usotamanocontinuo-fig) muestra el uso de una variable continua para determinar el tamaño de cada observación, note que a demás de la geometría relacionada al tamaño se debe usar la transparencia para evitar que los países con mayor población oculten o se sobrepongan a aquellos a países de menor población.

```{r usotamanocontinuo-fig, echo=FALSE, fig.align='center', fig.asp=.75, fig.cap='Asignación de tamaños mediante una variable continua', out.width='80%'}
data <- gapminder %>% filter(year=="2007") %>% dplyr::select(-year)
data %>%
  arrange(desc(pop)) %>%
  mutate(country = factor(country, country)) %>%
  ggplot(aes(x=gdpPercap, y=lifeExp, size = pop)) +
  geom_point(alpha=0.5) +
  scale_size(range = c(.1, 24)) + 
  theme(legend.position = 'none') +
  labs(title = "GDP per capita and life expectancy")
```

### Color

El color es una de las estéticas más importantes y que pueden marcar una gran diferencia en la interpretación de sus datos. Existen algunos colores que destacan más que otros por lo que darán un peso innecesario a los datos, es decir, que atraen la atención de los usuarios a esos puntos y que pueden no necesariamente ser los de interés central, también es recomendable no superar los seis colores por gráfico. El color dentro de una visualización puede ser usado principalmente para tres casos: para distinguir grupos de datos entre sí, uso del color para representar valores de datos y finalmente puede ser usado para resaltar.

#### Distinguir grupos de datos

Emplear el color como una herramienta para distinguir es uno de los usos más comunes que se le da al color cuando se trata de gráficos que incluyen variables categóricas y que no tienen un orden específico como diferentes niveles de formación dentro de una universidad o departamentos dentro de un mapa. En este caso, se utiliza una escala de colores cualitativa la cual contiene un conjunto finito de colores específicos que se eligen para versen claramente distintos entre sí y que al mismo tiempo deben ser equivalentes entre sí. Es decir que lo colores seleccionados se deben poder diferenciar de manera clara y precisa, pero uno no debe resaltar más que otro. También es importante que el conjunto de colores seleccionados no presente un orden ya que esto creara un orden en la visualización que por definición de los datos no se tiene. Como recomendación general, las escalas de color cualitativas funcionan mejor cuando hay de tres a cinco categorías diferentes; tener ocho o diez categorías hará que la tarea de hacer coincidir los colores sea tediosa, a demás la leyenda será demasiado extensa y el usuario tendrá que hacer un fuerte trabajo de búsqueda para identificar el color correspondiente a cada categoría; en el caso de muchas categorías se recomienda usar etiquetas directas sobre la observación para así facilitar la comprensión del gráfico aunque con esto también se debe tener cuidado ya que muchas etiquetas hará que la visualización se sature y la información no sea transmitida de la manera correcta.

La figura \@ref(fig:usocolordistinguir-fig) muestra el uso correcto de los colores como herramienta para distinguir, se seleccionaron colores que contrastan entre sí pero no compiten por la atención, este gráfico en particular posee ocho categorías distintas pero aún así se logra identificar claramente cada una de las sedes de admisión.


